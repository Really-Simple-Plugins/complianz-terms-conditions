{"version":3,"sources":["../../src/rules/noMissingSyntax.js"],"names":["setDefaults","state","selectorMap","incrementSelector","selector","comment","context","node","info","options","contexts","foundContext","find","cntxt","esquery","matches","parse","contextStr","contextSelected","exit","length","report","loc","start","column","line","message","some","contextKey","undefined","minimum","Object","values","every","cmmnt","data","end","matchContext","meta","docs","description","url","fixable","schema","additionalProperties","properties","items","anyOf","type"],"mappings":"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","sourcesContent":["import esquery from 'esquery';\nimport iterateJsdoc from '../iterateJsdoc';\n\nconst setDefaults = (state) => {\n  if (!state.selectorMap) {\n    state.selectorMap = {};\n  }\n};\n\nconst incrementSelector = (state, selector, comment) => {\n  if (!state.selectorMap[selector]) {\n    state.selectorMap[selector] = {};\n  }\n\n  if (!state.selectorMap[selector][comment]) {\n    state.selectorMap[selector][comment] = 0;\n  }\n\n  state.selectorMap[selector][comment]++;\n};\n\nexport default iterateJsdoc(({\n  context,\n  node,\n  info: {\n    comment,\n  },\n  state,\n}) => {\n  if (!context.options[0]) {\n    // Handle error later\n    return;\n  }\n\n  const {\n    contexts,\n  } = context.options[0];\n\n  const foundContext = contexts.find((cntxt) => {\n    return typeof cntxt === 'string' ?\n      esquery.matches(node, esquery.parse(cntxt)) :\n      (!cntxt.context || cntxt.context === 'any' || esquery.matches(node, esquery.parse(cntxt.context))) &&\n        comment === cntxt.comment;\n  });\n\n  const contextStr = typeof foundContext === 'object' ?\n    foundContext.context ?? 'any' :\n    foundContext;\n\n  setDefaults(state);\n\n  incrementSelector(state, contextStr, comment);\n}, {\n  contextSelected: true,\n  exit ({\n    context,\n    state,\n  }) {\n    if (!context.options.length) {\n      context.report({\n        loc: {\n          start: {\n            column: 1,\n            line: 1,\n          },\n        },\n        message: 'Rule `no-missing-syntax` is missing a `context` option.',\n      });\n\n      return;\n    }\n\n    setDefaults(state);\n\n    const {\n      contexts,\n    } = context.options[0];\n\n    // Report when MISSING\n    contexts.some((cntxt) => {\n      const contextStr = typeof cntxt === 'object' ? cntxt.context ?? 'any' : cntxt;\n      const comment = cntxt?.comment ?? '';\n\n      const contextKey = contextStr === 'any' ? undefined : contextStr;\n\n      if (\n        (!state.selectorMap[contextKey] ||\n        !state.selectorMap[contextKey][comment] ||\n        state.selectorMap[contextKey][comment] < (cntxt?.minimum ?? 1)) &&\n        (contextStr !== 'any' || Object.values(state.selectorMap).every((cmmnt) => {\n          return !cmmnt[comment] || cmmnt[comment] < (cntxt?.minimum ?? 1);\n        }))\n      ) {\n        const message = cntxt?.message ?? 'Syntax is required: {{context}}' +\n          (comment ? ' with {{comment}}' : '');\n        context.report({\n          data: {\n            comment,\n            context: contextStr,\n          },\n          loc: {\n            end: {\n              line: 1,\n            },\n            start: {\n              line: 1,\n            },\n          },\n          message,\n        });\n\n        return true;\n      }\n\n      return false;\n    });\n  },\n  matchContext: true,\n  meta: {\n    docs: {\n      description: 'Reports when certain comment structures are always expected.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-no-missing-syntax',\n    },\n    fixable: 'code',\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                    message: {\n                      type: 'string',\n                    },\n                    minimum: {\n                      type: 'integer',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"file":"noMissingSyntax.js"}